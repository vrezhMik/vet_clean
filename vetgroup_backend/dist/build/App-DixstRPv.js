const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ConfigureTheView-Cr_5UEVY.js","strapi-D25h1bXE.js","strapi-D6821bIJ.css"])))=>i.map(i=>d[i]);
import{a as v,w as he,ch as Be,cd as Ue,ck as Pe,eY as Q,cs as r,j as e,$ as S,H as D,dh as Ve,dk as ze,dl as Qe,f as k,fB as it,fC as ke,fD as ot,r as y,di as dt,T as ae,dm as lt,dp as rt,dn as ct,fE as ut,M as P,aX as Te,ct as Ie,l as M,fF as Oe,fG as gt,bI as se,I as N,bB as He,bJ as Ne,cz as u,h as Ge,fH as pt,fI as ht,dj as K,fJ as O,fK as ft,fL as xt,fM as Y,fN as mt,fO as jt,eF as yt,cc as Ct,fP as bt,fQ as We,fR as At,D as T,d9 as vt,fS as Mt,bE as qe,cq as wt,cp as St,fT as G,fU as Ft,fV as kt,L as Tt,bt as It,bu as Et,fW as Lt,fX as Rt,ff as _t,fY as $t,fZ as Dt,f_ as Bt,aJ as pe,u as ne,dG as Ee,f$ as Ut,g0 as Pt,g1 as Le,g2 as Vt,aO as Je,C as te,bV as zt,aQ as Xe,aI as Qt,eD as Ot,g3 as Ht,V as Nt,b as Gt,g4 as Wt,g5 as qt,g6 as Jt,g7 as Xt,g8 as Zt,g9 as Kt,P as V,a3 as Yt,cD as es,ga as ts,gb as ss,gc as ee,gd as as,ge as ns,gf as is,gg as os,gh as ds,gi as ls,bF as rs,bm as cs,gj as us,cS as ge,gk as gs,gl as ps,gm as hs,gn as fs,e_ as xs,R as ms,Q as Re,_ as js}from"./strapi-D25h1bXE.js";import{S as ys}from"./SearchInput-IPGNCOu-.js";const Cs=()=>{const{formatMessage:t}=v(),{toggleNotification:a}=he(),n=Be(),{post:s}=Ue(),i=Pe(({updates:p})=>s("/upload/actions/bulk-update",{updates:p}),{onSuccess(p){const{data:x}=p;x&&x.length>0&&(n.refetchQueries([Q,"assets"],{active:!0}),n.refetchQueries([Q,"asset-count"],{active:!0}),n.refetchQueries([Q,"folders"],{active:!0})),a({type:"success",message:t({id:r("modal.edit.success-label"),defaultMessage:"Files have been successfully updated."})})}});return{...i,edit:p=>i.mutateAsync({updates:p})}},Ze=M(mt)`
  opacity: 0;
  z-index: 1;

  &:focus-within {
    opacity: 1;
  }
`,bs=M(S)`
  background: ${({theme:t})=>t.colors.neutral0};
  border: 1px solid ${({theme:t})=>t.colors.neutral150};
  border-radius: ${({theme:t})=>t.borderRadius};

  &:hover {
    ${Ze} {
      opacity: 1;
    }
  }
`,As=({asset:t})=>{const{formatMessage:a}=v(),n=H("AssetCardActions",o=>o.dispatch),s=H("AssetCardActions",o=>o.state),d=H("AssetCardActions",o=>o.onClose),{canUpdate:i,canCopyLink:c,canDownload:p}=Oe(),[x,h]=y.useState(!1),{removeAsset:j}=gt(()=>{}),f=async o=>{o?.preventDefault(),await j(t.id),n({type:"remove_uploaded_asset",payload:{id:t.id}}),s.uploadedAssets.length===1&&d()},m=o=>{o.stopPropagation()},A=o=>{o&&(n({type:"edit_uploaded_asset",payload:{editedAsset:o}}),h(!1))};return e.jsxs(Ze,{onClick:m,position:"end",children:[e.jsxs(se.Root,{children:[e.jsx(se.Trigger,{children:e.jsx(N,{label:a({id:r("control-card.remove-selection"),defaultMessage:"Remove from selection"}),children:e.jsx(He,{})})}),e.jsx(Ne,{onConfirm:f})]}),e.jsxs(u.Root,{open:x,onOpenChange:h,children:[e.jsx(u.Trigger,{children:e.jsx(N,{label:a({id:r("control-card.edit"),defaultMessage:"Edit"}),children:e.jsx(Ge,{})})}),e.jsx(u.Content,{children:e.jsx(pt,{asset:{...t,isLocal:!1,folder:typeof t.folder=="number"?{id:t.folder}:t.folder},onClose:o=>A(o),canUpdate:i,canCopyLink:c,canDownload:p,omitFields:["caption","alternativeText"],omitActions:["replace"]})})]})]})},vs=M.span`
  text-transform: uppercase;
`,Ms=M(S)`
  position: relative;
  height: 100%;
  overflow: hidden;

  canvas,
  video {
    display: block;
    pointer-events: none;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: ${({theme:t})=>t.borderRadius};
  }
`,ws=M(jt)`
  position: absolute;
  bottom: 0.5rem;
  right: 0.5rem;
`,Ss=M(S)`
  height: 100%;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;

  canvas,
  audio {
    display: block;
    max-width: 100%;
    max-height: 100%;
  }
`,Fs=({assetType:t,thumbnailUrl:a,assetUrl:n,asset:s})=>{const[d,i]=y.useState(),c=d?ht(d):void 0;switch(t){case O.Image:return e.jsx(K,{src:a,size:"S",alt:s.alternativeText||s.name});case O.Video:return e.jsx(K,{size:"S",children:e.jsxs(Ms,{children:[e.jsx(xt,{url:n,mime:s.mime||"video/mp4",onLoadDuration:i,alt:s.alternativeText||s.name}),c&&e.jsx(ws,{children:c})]})});case O.Audio:return e.jsx(K,{size:"S",children:e.jsx(Ss,{children:e.jsx(ft,{url:n,alt:s.alternativeText||s.name})})});default:return e.jsx(K,{src:a,size:"S",alt:s.alternativeText||s.name})}},ks=M(ze)`
  display: flex;
  padding: ${({theme:t})=>t.spaces[2]} ${({theme:t})=>t.spaces[1]};
`,Ts=M(Ve)`
  width: 100%;
  height: 100%;
  border: none;
  box-shadow: none;
  border-radius: 0;
  padding: 0;
`,Is=t=>{switch(t){case O.Image:return{id:r("settings.section.image.label"),defaultMessage:"IMAGE"};case O.Video:return{id:r("settings.section.video.label"),defaultMessage:"VIDEO"};case O.Audio:return{id:r("settings.section.audio.label"),defaultMessage:"AUDIO"};case Y.Pdf:return{id:r("settings.section.pdf.label"),defaultMessage:"PDF"};case Y.Csv:return{id:r("settings.section.csv.label"),defaultMessage:"CSV"};case Y.Xls:return{id:r("settings.section.xls.label"),defaultMessage:"XLS"};case Y.Zip:return{id:r("settings.section.zip.label"),defaultMessage:"ZIP"};default:return{id:r("settings.section.doc.label"),defaultMessage:"DOC"}}},Es=({asset:t,onCaptionChange:a,onAltTextChange:n,wasAltTextChanged:s,wasCaptionChanged:d})=>{const{formatMessage:i}=v(),c=it(t.mime||""),p=ke(t?.formats?.thumbnail?.url||t.url)||"",x=ke(t.url)||"",h=t.height&&t.width?` - ${t.width}x${t.height}`:"",j=t.size?ot(t.size):"",f=`${h}${h&&j?" - ":""}${j}`,[m,A]=y.useState(t.caption||"");y.useEffect(()=>{a(m)},[m,a]);const[o,L]=y.useState(t.alternativeText||"");return y.useEffect(()=>{n(o)},[o,n]),e.jsx(bs,{children:e.jsxs(D.Root,{children:[e.jsx(D.Item,{m:5,xs:12,alignItems:"stretch",children:e.jsxs(Ts,{width:"100%",height:"100%",shadow:"none",borderRadius:0,padding:0,children:[e.jsxs(dt,{style:{borderStyle:"none"},children:[e.jsx(As,{asset:t}),e.jsx(Fs,{assetType:c,thumbnailUrl:p,assetUrl:x,asset:t})]}),e.jsx(ks,{children:e.jsxs(Qe,{width:"100%",children:[e.jsxs(k,{justifyContent:"space-between",alignItems:"start",children:[e.jsx(ae,{tag:"h2",children:e.jsx(lt,{tag:"span",children:t.name})}),e.jsx(rt,{children:i(Is(c))})]}),e.jsx(k,{children:e.jsxs(ct,{children:[e.jsx(vs,{children:ut(t.ext)}),f]})})]})})]})}),e.jsx(D.Item,{m:7,xs:12,flex:1,children:e.jsxs(k,{direction:"column",height:"100%",alignItems:"stretch",flex:1,padding:4,gap:2,children:[e.jsxs(P.Root,{name:"caption",children:[e.jsx(k,{alignItems:"center",gap:2,children:e.jsx(P.Label,{children:i({id:r("form.input.label.file-caption"),defaultMessage:"Caption"})})}),e.jsx(Te,{value:m,onChange:F=>A(F.target.value),placeholder:i({id:r("form.input.placeholder.file-caption"),defaultMessage:"Enter caption"}),endAction:!d&&t.caption&&e.jsx(Ie,{width:"16px",height:"16px",fill:"#AC73E6"}),type:"text"})]}),e.jsxs(P.Root,{name:"alternativeText",hint:i({id:r("form.input.description.file-alt"),defaultMessage:"This text will be displayed if the asset can't be shown."}),children:[e.jsx(k,{alignItems:"center",gap:2,children:e.jsx(P.Label,{children:i({id:r("form.input.label.file-alt"),defaultMessage:"Alternative text"})})}),e.jsx(Te,{value:o,onChange:F=>L(F.target.value),placeholder:i({id:r("form.input.placeholder.file-alt"),defaultMessage:"Enter alternative text"}),endAction:!s&&t.alternativeText&&e.jsx(Ie,{width:"16px",height:"16px",fill:"#AC73E6"}),type:"text"}),e.jsx(P.Hint,{})]})]})})]})})},$=M(S)`
  background: linear-gradient(
    90deg,
    ${({theme:t})=>t.colors.neutral100} 25%,
    ${({theme:t})=>t.colors.neutral150} 50%,
    ${({theme:t})=>t.colors.neutral100} 75%
  );
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  border-radius: ${({theme:t})=>t.borderRadius};
  width: ${({width:t})=>t||"100%"};
  height: ${({height:t})=>t||"1rem"};

  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }
`,Ls=({count:t=1})=>Array.from({length:t},(n,s)=>s).map(n=>e.jsx(S,{background:"neutral0",borderColor:"neutral150",borderStyle:"solid",borderWidth:"1px",borderRadius:"4px",marginBottom:4,children:e.jsxs(D.Root,{children:[e.jsx(D.Item,{col:5,alignItems:"stretch",children:e.jsxs(Ve,{height:"100%",width:"100%",borderStyle:"none",shadow:"none",borderRadius:0,padding:2,children:[e.jsx(S,{height:"150px",padding:2,children:e.jsx($,{height:"100%"})}),e.jsx(ze,{style:{display:"flex",padding:"8px 4px"},children:e.jsxs(Qe,{width:"100%",children:[e.jsxs(k,{justifyContent:"space-between",alignItems:"start",marginBottom:1,children:[e.jsx($,{width:"60%",height:"18px"}),e.jsx($,{width:"40px",height:"16px"})]}),e.jsx($,{width:"80%",height:"14px"})]})})]})}),e.jsx(D.Item,{m:7,xs:12,flex:1,children:e.jsxs(k,{direction:"column",height:"100%",alignItems:"stretch",flex:1,padding:4,gap:2,children:[e.jsxs(S,{children:[e.jsx($,{width:"60px",height:"16px",marginBottom:1}),e.jsx($,{height:"32px"})]}),e.jsxs(S,{children:[e.jsx($,{width:"100px",height:"16px",marginBottom:1}),e.jsx($,{height:"32px"}),e.jsx(S,{marginTop:1,children:e.jsx($,{width:"70%",height:"12px"})})]})]})})]})},n)),_e=M(u.Body)`
  padding: 0;
  display: flex;
  justify-content: center;

  [data-radix-scroll-area-viewport] {
    padding-top: ${({theme:t})=>t.spaces[6]};
    padding-bottom: ${({theme:t})=>t.spaces[6]};
    padding-left: ${({theme:t})=>t.spaces[7]};
    padding-right: ${({theme:t})=>t.spaces[7]};
  }
`,Rs=M(vt)`
  & > button {
    display: none;
  }
`,_s=({onClose:t})=>{const{formatMessage:a}=v(),{toggleNotification:n}=he(),s=H("ModalContent",g=>g.state),d=H("ModalContent",g=>g.dispatch),i=H("ModalContent",g=>g.folderId),{upload:c}=bt(),{edit:p,isLoading:x}=Cs(),[h,j]=y.useState(!1),[f,m]=y.useState(null),{trackUsage:A}=We(),o=(g,b)=>{d({type:"set_uploaded_asset_caption",payload:{id:g,caption:b}})},L=(g,b)=>{d({type:"set_uploaded_asset_alt_text",payload:{id:g,altText:b}})},F=()=>{d({type:"set_uploaded_assets",payload:[]})},W=async()=>{if(s.hasUnsavedChanges){const g=s.uploadedAssets.filter(b=>(b.wasCaptionChanged||b.wasAltTextChanged)&&b.file.id);if(g.length>0){g.some(C=>C.wasCaptionChanged)&&A("didEditAICaption"),g.some(C=>C.wasAltTextChanged)&&A("didEditAIAlternativeText");const b=g.map(C=>({id:C.file.id,fileInfo:{name:C.file.name,alternativeText:C.file.alternativeText??null,caption:C.file.caption??null,folder:typeof C.file.folder=="object"&&C.file.folder!==null?C.file.folder.id:C.file.folder}}));try{await p(b),d({type:"clear_unsaved_changes"})}catch(C){n({type:"danger",message:(C instanceof Error?C.message:null)||a({id:"notification.error",defaultMessage:"An error occurred"})});return}}}F(),t()},q=()=>{F(),t()},R=async g=>{d({type:"set_assets_to_upload_length",payload:g.length}),m(null),j(!0);try{const b=g.map(B=>({...B,id:B.id?Number(B.id):void 0})),U=(await c(b,i)).map(B=>({...B,folder:i||B.folder}));d({type:"set_uploaded_assets",payload:U})}catch(b){console.error("Upload failed:",b),m(b instanceof Error?b:new Error("Upload failed"))}finally{j(!1)}};if(s.assetsToUploadLength===0)return e.jsx(u.Content,{children:e.jsx(At,{onClose:t,onAddAsset:R})});if(h||s.assetsToUploadLength>0&&s.uploadedAssets.length===0&&!f)return e.jsxs(u.Content,{children:[e.jsx(u.Header,{children:e.jsx(u.Title,{children:a({id:r("ai.modal.uploading.title"),defaultMessage:"Uploading and processing with AI..."})})}),e.jsx(_e,{children:e.jsx(Ls,{count:s.assetsToUploadLength})})]});const w=a({id:r("ai.modal.title"),defaultMessage:"{count, plural, one {# asset uploaded} other {# assets uploaded}}, review AI generated metadata"},{count:s.uploadedAssets.length});return f?e.jsxs(u.Content,{children:[e.jsx(u.Header,{children:e.jsx(u.Title,{children:w})}),e.jsx(u.Body,{children:e.jsx(Rs,{closeLabel:"",variant:"danger",children:a({id:r("ai.modal.error"),defaultMessage:"Could not generate AI metadata for the uploaded files."})})}),e.jsxs(u.Footer,{children:[e.jsx(T,{onClick:q,variant:"tertiary",children:a({id:"cancel",defaultMessage:"Cancel"})}),e.jsx(T,{onClick:W,loading:x,children:a({id:"global.finish",defaultMessage:"Finish"})})]})]}):e.jsxs(u.Content,{children:[e.jsx(u.Header,{children:e.jsx(u.Title,{children:w})}),e.jsx(_e,{children:e.jsx(k,{gap:6,direction:"column",alignItems:"stretch",children:s.uploadedAssets.map(({file:g,wasCaptionChanged:b,wasAltTextChanged:C})=>e.jsx(Es,{asset:g,onCaptionChange:U=>g.id&&o(g.id,U),onAltTextChange:U=>g.id&&L(g.id,U),wasCaptionChanged:b,wasAltTextChanged:C},g.id))})}),e.jsxs(u.Footer,{children:[e.jsx(T,{onClick:q,variant:"tertiary",children:a({id:"cancel",defaultMessage:"Cancel"})}),e.jsx(T,{onClick:W,loading:x,children:a({id:"global.finish",defaultMessage:"Finish"})})]})]})},[$s,H]=yt("AIUploadModalContext"),Ds=(t,a)=>Ct(t,n=>{if(a.type==="set_uploaded_assets"&&(n.uploadedAssets=a.payload.map(s=>({file:s,wasCaptionChanged:!1,wasAltTextChanged:!1})),n.hasUnsavedChanges=!1),a.type==="set_assets_to_upload_length"&&(n.assetsToUploadLength=a.payload),a.type==="set_uploaded_asset_caption"){const s=n.uploadedAssets.find(d=>d.file.id===a.payload.id);s&&s.file.caption!==a.payload.caption&&(s.file.caption=a.payload.caption,s.wasCaptionChanged=!0,n.hasUnsavedChanges=!0)}if(a.type==="set_uploaded_asset_alt_text"){const s=n.uploadedAssets.find(d=>d.file.id===a.payload.id);s&&s.file.alternativeText!==a.payload.altText&&(s.file.alternativeText=a.payload.altText,s.wasAltTextChanged=!0,n.hasUnsavedChanges=!0)}if(a.type==="remove_uploaded_asset"&&(n.uploadedAssets=n.uploadedAssets.filter(s=>s.file.id!==a.payload.id)),a.type==="edit_uploaded_asset"){const s=n.uploadedAssets.findIndex(d=>d.file.id===a.payload.editedAsset.id);s!==-1&&(n.uploadedAssets[s]={file:a.payload.editedAsset,wasCaptionChanged:n.uploadedAssets[s].wasCaptionChanged,wasAltTextChanged:n.uploadedAssets[s].wasAltTextChanged})}a.type==="clear_unsaved_changes"&&(n.hasUnsavedChanges=!1,n.uploadedAssets.forEach(s=>{s.wasCaptionChanged=!1,s.wasAltTextChanged=!1}))}),Bs=({open:t,onClose:a,folderId:n=null})=>{const[s,d]=y.useReducer(Ds,{uploadedAssets:[],assetsToUploadLength:0,hasUnsavedChanges:!1}),i=y.useCallback(()=>{d({type:"set_uploaded_assets",payload:[]}),a()},[a]);return e.jsx($s,{state:s,dispatch:d,folderId:n,onClose:i,children:e.jsx(u.Root,{open:t,onOpenChange:i,children:e.jsx(_s,{onClose:i})})})},Us=t=>{const{id:a}=Mt();return e.jsx(S,{position:"relative",zIndex:2,children:e.jsx(qe,{"aria-labelledby":`${a}-title`,...t})})},Ps=()=>{const t=wt(),{status:a,data:n}=St(t);return t?{status:a,isEnabled:n?.aiMetadata}:{status:"success",isEnabled:!1}},Vs=(t,{pathname:a,query:n})=>{const s=[{id:null,label:{id:r("plugin.name"),defaultMessage:"Media Library"},href:t?G(a,n||{}):void 0}];return t?.parent&&typeof t?.parent!="number"&&t?.parent?.parent&&s.push([]),t?.parent&&typeof t.parent!="number"&&s.push({id:t.parent.id,label:t.parent.name,href:G(a,n||{},{folder:t.parent.id?.toString(),folderPath:t.parent.path})}),t&&s.push({id:t.id,label:t.name}),s},zs=({selected:t,onSuccess:a})=>{const{formatMessage:n}=v(),{remove:s}=Ft(),d=async()=>{await s(t),a()};return e.jsxs(se.Root,{children:[e.jsx(se.Trigger,{children:e.jsx(T,{variant:"danger-light",size:"S",startIcon:e.jsx(He,{}),children:n({id:"global.delete",defaultMessage:"Delete"})})}),e.jsx(Ne,{onConfirm:d})]})},Qs=()=>{const{formatMessage:t}=v(),{toggleNotification:a}=he(),n=Be(),{post:s}=Ue(),i=Pe(({destinationFolderId:p,filesAndFolders:x})=>{const h=x.reduce((j,f)=>{const{id:m,type:A}=f,o=A==="asset"?"fileIds":"folderIds";return j[o]||(j[o]=[]),j[o].push(m),j},{});return s("/upload/actions/bulk-move",{...h,destinationFolderId:p})},{onSuccess(p){const{data:{data:x}}=p;x?.files?.length>0&&(n.refetchQueries([Q,"assets"],{active:!0}),n.refetchQueries([Q,"asset-count"],{active:!0})),n.refetchQueries([Q,"folders"],{active:!0}),a({type:"success",message:t({id:r("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."})})}});return{...i,move:(p,x)=>i.mutateAsync({destinationFolderId:p,filesAndFolders:x})}},Os=({onClose:t,selected:a=[],currentFolder:n})=>{const{formatMessage:s}=v(),{data:d,isLoading:i}=kt(),{move:c}=Qs();if(!d)return null;const p=async(h,{setErrors:j})=>{try{if(typeof h.destination!="string"){const f=h.destination.value;await c(f,a),t()}}catch(f){const m=Rt(f);if(m&&"errors"in m){const A=m.errors?.reduce((o,L)=>(o[L.values?.path?.length||"destination"]=L.defaultMessage,o),{});_t(A)||j(A)}}};if(i)return e.jsx(u.Content,{children:e.jsx(u.Body,{children:e.jsx(k,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:e.jsx(Tt,{children:s({id:r("content.isLoading"),defaultMessage:"Content is loading."})})})})});const x={destination:{value:n?.id||"",label:n?.name||d[0].label}};return e.jsx(u.Content,{children:e.jsx(It,{validateOnChange:!1,onSubmit:p,initialValues:x,children:({values:h,errors:j,setFieldValue:f})=>e.jsxs(Et,{noValidate:!0,children:[e.jsx(u.Header,{children:e.jsx(u.Title,{children:s({id:r("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),e.jsx(u.Body,{children:e.jsx(D.Root,{gap:4,children:e.jsx(D.Item,{xs:12,direction:"column",alignItems:"stretch",children:e.jsxs(P.Root,{id:"folder-destination",children:[e.jsx(P.Label,{children:s({id:r("form.input.label.folder-location"),defaultMessage:"Location"})}),e.jsx(Lt,{options:d,onChange:m=>{f("destination",m)},defaultValue:typeof h.destination!="string"?h.destination:void 0,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:j?.destination,ariaErrorMessage:"destination-error"}),j.destination&&e.jsx(ae,{variant:"pi",tag:"p",textColor:"danger600",children:j.destination})]})})})}),e.jsxs(u.Footer,{children:[e.jsx(u.Close,{children:e.jsx(T,{variant:"tertiary",name:"cancel",children:s({id:"global.cancel",defaultMessage:"Cancel"})})}),e.jsx(T,{type:"submit",loading:i,children:s({id:"global.move",defaultMessage:"Move"})})]})]})})})},Hs=({selected:t=[],onSuccess:a,currentFolder:n})=>{const{formatMessage:s}=v(),[d,i]=y.useState(!1),c=()=>{i(!1),a()};return e.jsxs(u.Root,{open:d,onOpenChange:i,children:[e.jsx(u.Trigger,{children:e.jsx(T,{variant:"secondary",size:"S",startIcon:e.jsx($t,{}),children:s({id:"global.move",defaultMessage:"Move"})})}),e.jsx(Os,{currentFolder:n,onClose:c,selected:t})]})},Ns=({selected:t=[],onSuccess:a,currentFolder:n})=>{const{formatMessage:s}=v(),d=t?.reduce(function(i,c){return c?.type==="folder"&&"files"in c&&c?.files&&"count"in c.files?i+c?.files?.count:i+1},0);return e.jsxs(k,{gap:2,paddingBottom:5,children:[e.jsx(ae,{variant:"epsilon",textColor:"neutral600",children:s({id:r("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:t?.filter(({type:i})=>i==="folder").length,numberAssets:d})}),e.jsx(zs,{selected:t,onSuccess:a}),e.jsx(Hs,{currentFolder:n,selected:t,onSuccess:a})]})},Gs=({isFiltering:t,canCreate:a,canRead:n})=>t?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:n?a?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},Ws=({canCreate:t,isFiltering:a,canRead:n,onActionClick:s})=>{const{formatMessage:d}=v(),i=Gs({isFiltering:a,canCreate:t,canRead:n});return e.jsx(Dt,{icon:n?void 0:Bt,action:t&&!a&&e.jsx(T,{variant:"secondary",startIcon:e.jsx(pe,{}),onClick:s,children:d({id:r("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:d({...i,id:r(i.id)})})},qs=()=>{const[t,a]=y.useState(!1),{formatMessage:n}=v(),{trackUsage:s}=We(),[{query:d},i]=ne(),c=d?.filters?.$and||[],p=h=>{i({filters:{$and:h},page:1})},x=h=>{s("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(h[h.length-1])[0]}),i({filters:{$and:h},page:1})};return e.jsxs(Ee.Root,{open:t,onOpenChange:a,children:[e.jsx(Ee.Trigger,{children:e.jsx(T,{variant:"tertiary",startIcon:e.jsx(Ut,{}),size:"S",children:n({id:"app.utils.filters",defaultMessage:"Filters"})})}),e.jsx(Pt,{displayedFilters:Le,filters:c,onSubmit:x,onToggle:a}),e.jsx(Vt,{appliedFilters:c,filtersSchema:Le,onRemoveFilter:p})]})},Js=({breadcrumbs:t=null,canCreate:a,folder:n=null,onToggleEditFolderDialog:s,onToggleUploadAssetDialog:d})=>{const{formatMessage:i}=v(),{pathname:c}=Je(),[{query:p}]=ne(),x={...p,folder:n?.parent&&typeof n.parent!="number"&&n.parent.id?n.parent.id:void 0,folderPath:n?.parent&&typeof n.parent!="number"&&n.parent.path?n.parent.path:void 0};return e.jsx(te.Header,{title:i({id:r("plugin.name"),defaultMessage:"Media Library"}),subtitle:t&&typeof t!="boolean"&&n&&e.jsx(Ht,{label:i({id:r("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:t,currentFolderId:n?.id}),navigationAction:n&&e.jsx(zt,{tag:Qt,startIcon:e.jsx(Ot,{}),to:`${c}?${Xe.stringify(x,{encode:!1})}`,children:i({id:r("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:a&&e.jsxs(k,{gap:2,children:[e.jsx(T,{startIcon:e.jsx(pe,{}),variant:"secondary",onClick:s,children:i({id:r("header.actions.add-folder"),defaultMessage:"Add new folder"})}),e.jsx(T,{startIcon:e.jsx(pe,{}),onClick:d,children:i({id:r("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})},Xs=M(S)`
  height: 3.2rem;
  display: flex;
  align-items: center;
`,$e=M(ae)`
  max-width: 100%;
`,De=M(S)`
  svg {
    path {
      fill: ${({theme:t})=>t.colors.neutral500};
    }
  }
`,Zs=()=>{const t=Nt(),{canRead:a,canCreate:n,canUpdate:s,canCopyLink:d,canDownload:i,canConfigureView:c,isLoading:p}=Oe(),{isEnabled:x,status:h}=Ps(),j=y.useRef(),{formatMessage:f}=v(),{pathname:m}=Je(),{trackUsage:A}=Gt(),[{query:o},L]=ne(),F=!!(o._q||o.filters),[W,q]=Wt(fs.view,ee.GRID),R=W===ee.GRID,{data:w,isLoading:g,error:b}=qt({skipWhen:!a,query:o}),{data:C,isLoading:U,error:B}=Jt({enabled:a&&w?.pagination?.page===1&&!Xt(o),query:o}),{data:ie,isLoading:fe,error:Ke}=Zt(o?.folder,{enabled:a&&!!o?.folder});Ke?.name==="NotFoundError"&&t(m);const J=C?.map(l=>({...l,type:"folder",folderURL:G(m,o,{folder:l.id.toString(),folderPath:l.path}),isSelectable:s}))??[],I=J?.length||0,X=w?.results?.map(l=>({...l,type:"asset",isSelectable:s}))||[],E=X?.length??0,Ye=w?.pagination?.total,et=fe||U||p||g||h==="loading",[oe,tt]=y.useState(!1),[xe,me]=y.useState(!1),[de,le]=y.useState(void 0),[re,je]=y.useState(void 0),[_,{selectOne:ce,selectAll:ye,setSelections:Ce}]=Kt(["type","id"],[]);y.useEffect(()=>{Ce([])},[o.folder,Ce]);const be=_?.length>0&&_?.length!==E+I,Z=()=>tt(l=>!l),Ae=({created:l=!1}={})=>{l&&o?.page!=="1"&&L({...o,page:1}),me(z=>!z)},ve=(l,z)=>{l&&A("didSelectAllMediaLibraryElements"),ye(z)},Me=l=>{A("didSortMediaLibraryElements",{location:"upload",sort:l}),L({sort:l})},we=l=>{je(l),me(!0)},st=l=>{je(null),Ae(l),j.current&&j.current.focus()},Se=l=>{l===E&&w?.pagination?.page===w?.pagination?.pageCount&&w?.pagination?.page&&w.pagination.page>1&&L({...o,page:w.pagination.page-1})},at=()=>{ye(),Se(_.length)};return et?e.jsx(V.Loading,{}):b||B||h==="error"?e.jsx(V.Error,{}):e.jsxs(te.Root,{children:[e.jsxs(V.Main,{children:[e.jsx(Js,{breadcrumbs:fe?null:Vs(ie,{pathname:m,query:o}),canCreate:n,onToggleEditFolderDialog:Ae,onToggleUploadAssetDialog:Z,folder:ie}),e.jsx(te.Action,{startActions:e.jsxs(e.Fragment,{children:[s&&R&&(E>0||I>0)&&e.jsx(Xs,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:e.jsx(qe,{"aria-label":f({id:r("bulk.select.label"),defaultMessage:"Select all folders & assets"}),checked:be?"indeterminate":(E>0||I>0)&&_.length===E+I,onCheckedChange:l=>ve(l,[...X,...J])})}),a&&R&&e.jsx(as,{value:o?.sort,onChangeSort:Me}),a&&e.jsx(qs,{})]}),endActions:e.jsxs(e.Fragment,{children:[c?e.jsx(De,{paddingTop:1,paddingBottom:1,children:e.jsx(N,{tag:Yt,to:{pathname:`${m}/configuration`,search:Xe.stringify(o,{encode:!1})},label:f({id:"app.links.configure-view",defaultMessage:"Configure the view"}),children:e.jsx(es,{})})}):null,e.jsx(De,{paddingTop:1,paddingBottom:1,children:e.jsx(N,{label:f(R?{id:r("view-switch.list"),defaultMessage:"List View"}:{id:r("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>q(R?ee.LIST:ee.GRID),children:R?e.jsx(ts,{}):e.jsx(ss,{})})}),e.jsx(ys,{label:f({id:r("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),e.jsxs(te.Content,{children:[_.length>0&&e.jsx(Ns,{currentFolder:ie,selected:_,onSuccess:at}),I===0&&E===0&&e.jsx(Ws,{canCreate:n,canRead:a,isFiltering:F,onActionClick:Z}),a&&!R&&(E>0||I>0)&&e.jsx(ns,{assetCount:E,folderCount:I,indeterminate:be,onChangeSort:Me,onChangeFolder:(l,z)=>t(G(m,o,{folder:l.toString(),folderPath:z})),onEditAsset:le,onEditFolder:we,onSelectOne:ce,onSelectAll:ve,rows:[...J,...X],selected:_,shouldDisableBulkSelect:!s,sortQuery:o?.sort??""}),a&&R&&e.jsxs(e.Fragment,{children:[I>0&&e.jsx(is,{title:(F&&E>0||!F)&&f({id:r("list.folders.title"),defaultMessage:"Folders ({count})"},{count:I})||"",children:J.map(l=>{const nt=!!_.filter(({type:ue})=>ue==="folder").find(ue=>ue.id===l.id),Fe=G(m,o,{folder:l?.id.toString(),folderPath:l?.path});return e.jsx(D.Item,{col:3,m:4,s:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(os,{ref:re&&l.id===re.id?j:void 0,ariaLabel:l.name,id:`folder-${l.id}`,to:Fe,startAction:l.isSelectable?e.jsx(Us,{"data-testid":`folder-checkbox-${l.id}`,checked:nt,onCheckedChange:()=>ce(l)}):null,cardActions:e.jsx(N,{label:f({id:r("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>we(l),children:e.jsx(Ge,{})}),children:e.jsx(ds,{children:e.jsx(ls,{to:Fe,children:e.jsxs(k,{tag:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[e.jsxs($e,{fontWeight:"semiBold",textColor:"neutral800",ellipsis:!0,children:[l.name,e.jsx(rs,{children:":"})]}),e.jsx($e,{tag:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:f({id:r("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:l.children?.count,filesCount:l.files?.count})})]})})})})},`folder-${l.id}`)})}),E>0&&I>0&&e.jsx(S,{paddingTop:6,paddingBottom:4,children:e.jsx(cs,{})}),E>0&&e.jsx(us,{assets:X,onEditAsset:le,onSelectAsset:ce,selectedAssets:_.filter(({type:l})=>l==="asset"),title:(!F||F&&I>0)&&w?.pagination?.page===1&&f({id:r("list.assets.title"),defaultMessage:"Assets ({count})"},{count:Ye})||""})]}),e.jsxs(ge.Root,{...w?.pagination,children:[e.jsx(ge.PageSize,{}),e.jsx(ge.Links,{})]})]})]}),oe&&(x?e.jsx(Bs,{open:oe,onClose:Z,folderId:o?.folder?Number(o.folder):null}):e.jsx(gs,{open:oe,onClose:Z,trackedLocation:"upload",folderId:o?.folder})),xe&&e.jsx(ps,{open:xe,onClose:()=>st(),folder:re,parentFolderId:o?.folder,location:"upload"}),de&&e.jsx(hs,{onClose:l=>{l===null&&Se(1),le(void 0)},open:!!de,asset:de,canUpdate:s,canCopyLink:d,canDownload:i,trackedLocation:"upload"})]})},Ks=y.lazy(async()=>js(()=>import("./ConfigureTheView-Cr_5UEVY.js"),__vite__mapDeps([0,1,2])).then(t=>({default:t.ConfigureTheView}))),ta=()=>{const{config:{isLoading:t,isError:a,data:n}}=xs(),[{rawQuery:s},d]=ne(),{formatMessage:i}=v(),c=i({id:r("plugin.name"),defaultMessage:"Media Library"});return y.useEffect(()=>{t||a||s||d({sort:n.sort,page:1,pageSize:n.pageSize})},[t,a,n,s,d]),t?e.jsx(V.Loading,{}):e.jsxs(V.Main,{children:[e.jsx(V.Title,{children:c}),s?e.jsx(y.Suspense,{fallback:e.jsx(V.Loading,{}),children:e.jsxs(ms,{children:[e.jsx(Re,{index:!0,element:e.jsx(Zs,{})}),e.jsx(Re,{path:"configuration",element:e.jsx(Ks,{config:n})})]})}):null]})};export{ta as Upload};
