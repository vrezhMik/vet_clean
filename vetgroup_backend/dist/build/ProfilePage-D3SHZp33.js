import{e as Q,aZ as M,a as c,b as Y,w as E,a_ as Z,aL as J,v as K,a4 as W,r as P,a$ as X,b0 as ee,j as e,P as x,B as se,b1 as ae,C as b,D as v,E as te,$ as p,f as g,b2 as I,b3 as re,b4 as ie,b5 as T,T as l,H as d,b6 as y,b7 as oe,b8 as ne}from"./strapi-D25h1bXE.js";import{g as le}from"./users-DLc-PG84.js";import{C as de}from"./validation-CFUVK3hq.js";const ce=ae().shape({...de,currentPassword:I().when(["password","confirmPassword"],(a,s,t)=>a||s?t.required({id:re.required.id,defaultMessage:"This field is required"}).nullable():t),preferedLanguage:I().nullable()}),f=({children:a,...s})=>e.jsx(p,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:e.jsx(g,{direction:"column",alignItems:"stretch",gap:4,...s,children:a})}),je=()=>{const a=Q(),s=M(o=>o.admin_app.language.localeNames),{formatMessage:t}=c(),{trackUsage:i}=Y(),{toggleNotification:r}=E(),{notifyStatus:j}=Z(),A=M(o=>o.admin_app.theme.currentTheme),L=J(),{_unstableFormatValidationErrors:R,_unstableFormatAPIError:_}=K(),u=W("ProfilePage",o=>o.user);P.useEffect(()=>{u?j(t({id:"Settings.profile.form.notify.data.loaded",defaultMessage:"Your profile data has been loaded"})):r({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occured"})})},[t,j,r,u]);const[C,{isLoading:k}]=X(),{isLoading:z,data:F,error:w}=ee(void 0,{skip:!(window.strapi.isEE&&window.strapi.features.isEnabled("sso"))});P.useEffect(()=>{w&&r({type:"danger",message:t({id:"Settings.permissions.users.sso.provider.error"})})},[w,t,r]);const N=async(o,{setErrors:h})=>{const{confirmPassword:fe,currentTheme:S,...V}=o;let m=V;if(m.password===""){const{password:he,currentPassword:xe,...$}=m;m=$}const n=await C(m);"data"in n&&(L(ie(S)),i("didChangeMode",{newMode:S}),r({type:"success",message:t({id:"notification.success.saved",defaultMessage:"Saved"})})),"error"in n&&(T(n.error)&&n.error.name==="ValidationError"?h(R(n.error)):T(n.error)?r({type:"danger",message:_(n.error)}):r({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occured"})}))};if(z)return e.jsx(x.Loading,{});const D=F?.isSSOLocked??!1,{email:O,firstname:U,lastname:B,username:q,preferedLanguage:H}=u??{},G={email:O??"",firstname:U??"",lastname:B??"",username:q??"",preferedLanguage:H,currentTheme:A,confirmPassword:"",password:""};return e.jsx(e.Fragment,{children:e.jsxs(x.Main,{"aria-busy":k,children:[e.jsx(x.Title,{children:t({id:"Settings.profile.form.section.head.title",defaultMessage:"User profile"})}),e.jsx(se,{method:"PUT",onSubmit:N,initialValues:G,validationSchema:ce,children:({isSubmitting:o,modified:h})=>e.jsxs(e.Fragment,{children:[e.jsx(b.Header,{title:le(u),primaryAction:e.jsx(v,{startIcon:e.jsx(te,{}),loading:o,type:"submit",disabled:!h,children:t({id:"global.save",defaultMessage:"Save"})})}),e.jsx(p,{paddingBottom:6,children:e.jsx(b.Content,{children:e.jsxs(g,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsx(pe,{}),!D&&e.jsx(ue,{}),e.jsx(me,{localeNames:s})]})})})]})}),a&&e.jsx(p,{children:e.jsx(b.Content,{children:e.jsx(ge,{})})})]})})},ue=()=>{const{formatMessage:a}=c();return e.jsxs(f,{children:[e.jsx(l,{variant:"delta",tag:"h2",children:a({id:"global.change-password",defaultMessage:"Change password"})}),[[{label:a({id:"Auth.form.currentPassword.label",defaultMessage:"Current Password"}),name:"currentPassword",size:6,type:"password"}],[{autoComplete:"new-password",label:a({id:"global.password",defaultMessage:"Password"}),name:"password",size:6,type:"password"},{autoComplete:"new-password",label:a({id:"Auth.form.confirmPassword.label",defaultMessage:"Confirm Password"}),name:"confirmPassword",size:6,type:"password"}]].map((s,t)=>e.jsx(d.Root,{gap:5,children:s.map(({size:i,...r})=>e.jsx(d.Item,{xs:12,m:6,col:i,direction:"column",alignItems:"stretch",children:e.jsx(y,{...r})},r.name))},t))]})},me=({localeNames:a})=>{const{formatMessage:s}=c(),t=M(i=>i.admin_app.theme.availableThemes);return e.jsxs(f,{children:[e.jsxs(g,{direction:"column",alignItems:"stretch",gap:1,children:[e.jsx(l,{variant:"delta",tag:"h2",children:s({id:"Settings.profile.form.section.experience.title",defaultMessage:"Experience"})}),e.jsx(l,{children:s({id:"Settings.profile.form.section.experience.interfaceLanguageHelp",defaultMessage:"Preference changes will apply only to you. More information is available {here}."},{here:e.jsx(p,{tag:"a",color:"primary600",target:"_blank",rel:"noopener noreferrer",href:"https://docs.strapi.io/developer-docs/latest/development/admin-customization.html#locales",children:s({id:"Settings.profile.form.section.experience.here",defaultMessage:"here"})})})})]}),e.jsx(d.Root,{gap:5,children:[{hint:s({id:"Settings.profile.form.section.experience.interfaceLanguage.hint",defaultMessage:"This will only display your own interface in the chosen language."}),label:s({id:"Settings.profile.form.section.experience.interfaceLanguage",defaultMessage:"Interface language"}),name:"preferedLanguage",options:Object.entries(a).map(([i,r])=>({label:r,value:i})),placeholder:s({id:"global.select",defaultMessage:"Select"}),size:6,type:"enumeration"},{hint:s({id:"Settings.profile.form.section.experience.mode.hint",defaultMessage:"Displays your interface in the chosen mode."}),label:s({id:"Settings.profile.form.section.experience.mode.label",defaultMessage:"Interface mode"}),name:"currentTheme",options:[{label:s({id:"Settings.profile.form.section.experience.mode.option-system-label",defaultMessage:"Use system settings"}),value:"system"},...t.map(i=>({label:s({id:"Settings.profile.form.section.experience.mode.option-label",defaultMessage:"{name} mode"},{name:s({id:i,defaultMessage:oe(i)})}),value:i}))],placeholder:s({id:"components.Select.placeholder",defaultMessage:"Select"}),size:6,type:"enumeration"}].map(({size:i,...r})=>e.jsx(d.Item,{xs:12,m:6,col:i,direction:"column",alignItems:"stretch",children:e.jsx(y,{...r})},r.name))})]})},pe=()=>{const{formatMessage:a}=c();return e.jsxs(f,{children:[e.jsx(l,{variant:"delta",tag:"h2",children:a({id:"global.profile",defaultMessage:"Profile"})}),e.jsx(d.Root,{gap:5,children:[{label:a({id:"Auth.form.firstname.label",defaultMessage:"First name"}),name:"firstname",required:!0,size:6,type:"string"},{label:a({id:"Auth.form.lastname.label",defaultMessage:"Last name"}),name:"lastname",size:6,type:"string"},{label:a({id:"Auth.form.email.label",defaultMessage:"Email"}),name:"email",required:!0,size:6,type:"email"},{label:a({id:"Auth.form.username.label",defaultMessage:"Username"}),name:"username",size:6,type:"string"}].map(({size:s,...t})=>e.jsx(d.Item,{xs:12,m:6,col:s,direction:"column",alignItems:"stretch",children:e.jsx(y,{...t})},t.name))})]})},ge=()=>{const{formatMessage:a}=c(),{toggleNotification:s}=E(),t=ne("ProfilePage",r=>r.dispatch),i=()=>{t({type:"reset_all_tours"}),s({type:"success",message:a({id:"tours.profile.notification.success.reset",defaultMessage:"Guided tour reset"})})};return e.jsxs(f,{alignItems:"start",children:[e.jsxs(g,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(l,{variant:"delta",tag:"h2",children:a({id:"tours.profile.title",defaultMessage:"Guided tour"})}),e.jsx(l,{variant:"pi",children:a({id:"tours.profile.description",defaultMessage:"You can reset the guided tour at any time."})})]}),e.jsx(v,{variant:"tertiary",onClick:i,children:a({id:"tours.profile.reset",defaultMessage:"Reset guided tour"})})]})};export{je as ProfilePage};
