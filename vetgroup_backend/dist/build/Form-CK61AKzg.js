import{a as A,w as ue,K as ee,aC as ge,cy as te,j as e,cz as $,B as ne,b1 as he,f as I,cA as ae,H as F,aF as u,b6 as ie,D as Y,bM as fe,bf as xe,b2 as U,cB as z,r as P,T as R,$ as be,cC as H,aJ as ye,cc as q,e as je,g as Ie,I as J,h as ve,k as Ce,bV as Fe,aI as se,cD as Me,cE as Se,cF as Q,l as oe,cG as _e,aS as Te,C as re,bm as ke,bv as De}from"./strapi-D25h1bXE.js";import{D as Re,S as $e,a as we,b as ze,u as Ee,c as de,C as Ne}from"./sortable.esm-smdJ416b.js";import{F as Be}from"./FieldTypeIcon-qUmDzA2c.js";const Le=he().shape({label:U().required().nullable(),description:U().nullable(),placeholder:U().nullable(),editable:xe(),size:fe().required()}),Pe=({attribute:t,name:a,onClose:s})=>{const{formatMessage:o}=A(),{toggleNotification:d}=ue(),{value:l,onChange:f}=ee(a),{data:v}=ge(void 0,{selectFromResult:m=>{if(t?.type!=="relation"||!m.data)return{data:[]};if("targetModel"in t&&typeof t.targetModel=="string"){const g=m.data.contentTypes.find(b=>b.uid===t.targetModel);if(g)return{data:Object.entries(g.attributes).reduce((b,[S,T])=>(te.includes(T.type)||b.push({label:S,value:S}),b),[])}}return{data:[]}},skip:t?.type!=="relation"});return!l||l.name===D||!t?(console.error("You've opened a field to edit without it being part of the form, this is likely a bug with Strapi. Please open an issue."),d({message:o({id:"content-manager.containers.edit-settings.modal-form.error",defaultMessage:"An error occurred while trying to open the form."}),type:"danger"}),null):e.jsx($.Content,{children:e.jsxs(ne,{method:"PUT",initialValues:l,validationSchema:Le,onSubmit:m=>{f(a,m),s()},children:[e.jsx($.Header,{children:e.jsxs(I,{gap:3,children:[e.jsx(Be,{type:t.type}),e.jsx($.Title,{children:o({id:"content-manager.containers.edit-settings.modal-form.label",defaultMessage:"Edit {fieldName}"},{fieldName:ae(l.name)})})]})}),e.jsx($.Body,{children:e.jsx(F.Root,{gap:4,children:[{name:"label",label:o({id:u("containers.edit-settings.modal-form.label"),defaultMessage:"Label"}),size:6,type:"string"},{name:"description",label:o({id:u("containers.edit-settings.modal-form.description"),defaultMessage:"Description"}),size:6,type:"string"},{name:"placeholder",label:o({id:u("containers.edit-settings.modal-form.placeholder"),defaultMessage:"Placeholder"}),size:6,type:"string"},{name:"editable",label:o({id:u("containers.edit-settings.modal-form.editable"),defaultMessage:"Editable"}),size:6,type:"boolean"},{name:"mainField",label:o({id:u("containers.edit-settings.modal-form.mainField"),defaultMessage:"Entry title"}),hint:o({id:u("containers.SettingPage.edit-settings.modal-form.mainField.hint"),defaultMessage:"Set the displayed field"}),size:6,options:v,type:"enumeration"},{name:"size",label:o({id:u("containers.ListSettingsView.modal-form.size"),defaultMessage:"Size"}),size:6,options:[{value:"4",label:"33%"},{value:"6",label:"50%"},{value:"8",label:"66%"},{value:"12",label:"100%"}],type:"enumeration"}].filter(Ae(t.type)).map(({size:m,...g})=>e.jsx(F.Item,{col:m,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(ie,{...g})},g.name))})}),e.jsxs($.Footer,{children:[e.jsx($.Close,{children:e.jsx(Y,{variant:"tertiary",children:o({id:"app.components.Button.cancel",defaultMessage:"Cancel"})})}),e.jsx(Y,{type:"submit",children:o({id:"global.finish",defaultMessage:"Finish"})})]})]})})},Ae=t=>a=>{switch(t){case"blocks":case"richtext":return a.name!=="size"&&a.name!=="mainField";case"boolean":case"media":return a.name!=="placeholder"&&a.name!=="mainField";case"component":return a.name==="label"||a.name==="editable";case"dynamiczone":case"json":return a.name!=="placeholder"&&a.name!=="mainField"&&a.name!=="size";case"relation":return!0;default:return a.name!=="mainField"}},L=12,Oe=({id:t,children:a})=>{const s=Ee({id:t});return a(s)},We=({id:t,children:a})=>{const{attributes:s,setNodeRef:o,transform:d,transition:l}=de({id:t}),f={transform:Ne.Transform.toString(d),transition:l,height:"100%"};return e.jsx("div",{ref:o,style:f,...s,children:a})},X=t=>t.map((a,s)=>({...a,dndId:`container-${s}`,children:a.children.map((o,d)=>({...o,dndId:`container-${s}-child-${d}`,formName:`layout.${s}.children.${d}`}))})),He=({attributes:t,fieldSizes:a,components:s,metadatas:o={}})=>{const{formatMessage:d}=A(),l=z("Fields",n=>n.values.layout??[]),f=z("Fields",n=>n.onChange),v=z("Fields",n=>n.addFieldRow),m=z("Fields",n=>n.removeFieldRow),g=l.map(n=>n.children.map(i=>i.name)).flat(),b=Object.entries(o).reduce((n,i)=>{const[r,{visible:c,...y}]=i;if(!g.includes(r)&&c===!0){const x=t[r]?.type,j=x?a[x]:L;n.push({...y,label:y.label??r,name:r,size:j})}return n},[]),S=(n,i)=>()=>{l[n].children.length===1?m("layout",n):f(`layout.${n}.children`,[...l[n].children.slice(0,i),...l[n].children.slice(i+1)])},T=n=>()=>{v("layout",{children:[n]})},[C,p]=P.useState(()=>X(l)),[k,E]=P.useState(null);function N(n,i){return n in i?n:Object.keys(i).find(r=>i[r].children.find(c=>c.dndId===n))}const V=(n,i)=>i.children.find(r=>n===r.dndId),G=()=>Object.fromEntries(C.map(n=>[n.dndId,n])),le=n=>n.map(i=>({...i,children:i.children.filter(r=>r.name!==D)})).filter(i=>i.children.length>0).map(i=>{const r=i.children.reduce((c,y)=>c+y.size,0);if(r<L){const[c]=Q(i.children.at(-1)?.__temp_key__,void 0,1);return{...i,children:[...i.children,{name:D,size:L-r,__temp_key__:c}]}}return i});return P.useEffect(()=>{const n=X(l);p(n)},[l,p]),e.jsx(Re,{onDragStart:n=>{const i=G(),r=N(n.active.id,i);if(!r)return;const c=V(n.active.id,i[r]);c&&E(c)},onDragOver:({active:n,over:i})=>{const r=G(),c=N(n.id,r),y=N(i?.id??"",r),x=C.findIndex(h=>h.dndId===c),j=C.findIndex(h=>h.dndId===y);if(!c||!y)return;const _=V(n.id,r[c]),O=V(i?.id??"",r[y]),B=r[y].children.findIndex(h=>h.dndId===i?.id);if(!_)return;if(_?.size===L){const h=q(C,W=>{W[x].children=C[j].children,W[j].children=C[x].children});p(h);return}const K=q(C,h=>{if(h[x].children=h[x].children.filter(w=>w.dndId!==n.id),h[j].children.reduce((w,M)=>M.name===D?w:w+M.size,0)+_.size>L){h[x].children=C[x].children;return}if(O?.name===D){h[j].children.splice(B,1,_);return}h[j].children.splice(B,0,_)});p(K)},onDragEnd:n=>{const{active:i,over:r}=n,{id:c}=i,y=r?.id,x=G(),j=N(c,x),_=N(y,x);if(!j||!_)return;const O=x[j].children.findIndex(M=>M.dndId===c),B=x[_].children.findIndex(M=>M.dndId===y),K=q(x,M=>{O!==B&&j===_&&(M[j].children=ze(M[j].children,O,B))}),h=Object.values(K),w=le(h).map(({dndId:M,children:ce,...me})=>({...me,children:ce.map(({dndId:Xe,formName:Ze,...pe})=>pe)}));f("layout",w),E(null)},children:e.jsxs(I,{paddingTop:6,direction:"column",alignItems:"stretch",gap:4,children:[e.jsxs(I,{alignItems:"flex-start",direction:"column",justifyContent:"space-between",children:[e.jsx(R,{fontWeight:"bold",children:d({id:u("containers.list.displayedFields"),defaultMessage:"Displayed fields"})}),e.jsx(R,{variant:"pi",textColor:"neutral600",children:d({id:"containers.SettingPage.editSettings.description",defaultMessage:"Drag & drop the fields to build the layout"})})]}),e.jsx(be,{padding:4,hasRadius:!0,borderStyle:"dashed",borderWidth:"1px",borderColor:"neutral300",children:e.jsxs(I,{direction:"column",alignItems:"stretch",gap:2,children:[C.map((n,i)=>e.jsx($e,{id:n.dndId,items:n.children.map(r=>({id:r.dndId})),children:e.jsx(Oe,{id:n.dndId,children:({setNodeRef:r})=>e.jsx(F.Root,{ref:r,gap:2,children:n.children.map((c,y)=>e.jsx(F.Item,{col:c.size,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(We,{id:c.dndId,children:e.jsx(Z,{attribute:t[c.name],components:s,name:c.formName,onRemoveField:S(i,y),dndId:c.dndId})})},c.dndId))},n.dndId)})},n.dndId)),e.jsx(we,{children:k?e.jsx(Z,{attribute:t[k.name],components:s,name:k.formName,dndId:k.dndId}):null}),e.jsxs(H.Root,{children:[e.jsx(H.Trigger,{startIcon:e.jsx(ye,{}),endIcon:null,disabled:b.length===0,fullWidth:!0,variant:"secondary",children:d({id:u("containers.SettingPage.add.field"),defaultMessage:"Insert another field"})}),e.jsx(H.Content,{children:b.map(n=>e.jsx(H.Item,{onSelect:T(n),children:n.label},n.name))})]})]})})]})})},D="_TEMP_",Z=({attribute:t,components:a,name:s,onRemoveField:o,dndId:d})=>{const l=je(),[f,v]=P.useState(!1),{formatMessage:m}=A(),{value:g}=ee(s),{listeners:b,setActivatorNodeRef:S}=de({id:d}),T=p=>{p.preventDefault(),p.stopPropagation(),o&&o?.(p)},C=p=>{p.preventDefault(),p.stopPropagation(),v(!0)};return g?g.name===D?e.jsx(I,{tag:"span",height:"100%",style:{opacity:0}}):t?e.jsxs($.Root,{open:f,onOpenChange:v,children:[e.jsxs(I,{borderColor:"neutral150",background:"neutral100",hasRadius:!0,gap:3,cursor:"pointer",onClick:()=>{v(!0)},position:"relative",children:[l&&e.jsx(Ve,{ref:S,tag:"span",withTooltip:!1,label:m({id:u("components.DraggableCard.move.field"),defaultMessage:"Move {item}"},{item:g.label}),...b,children:e.jsx(Ie,{})}),e.jsxs(I,{direction:"column",alignItems:"flex-start",grow:1,overflow:"hidden",children:[e.jsxs(I,{gap:3,justifyContent:"space-between",width:"100%",children:[e.jsx(R,{ellipsis:!0,fontWeight:"bold",children:g.label}),e.jsxs(I,{position:"relative",children:[e.jsx(J,{type:"button",variant:"ghost",background:"transparent",onClick:C,withTooltip:!1,label:m({id:u("components.DraggableCard.edit.field"),defaultMessage:"Edit {item}"},{item:g.label}),children:e.jsx(ve,{})}),e.jsx(J,{type:"button",variant:"ghost",onClick:T,background:"transparent",withTooltip:!1,label:m({id:u("components.DraggableCard.delete.field"),defaultMessage:"Delete {item}"},{item:g.label}),children:e.jsx(Ce,{})})]})]}),t?.type==="component"?e.jsxs(I,{paddingTop:3,paddingRight:3,paddingBottom:3,paddingLeft:0,alignItems:"flex-start",direction:"column",gap:2,width:"100%",children:[e.jsx(F.Root,{gap:4,width:"100%",children:a[t.component].layout.map(p=>p.map(({size:k,...E})=>e.jsx(F.Item,{col:k,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(I,{alignItems:"center",background:"neutral0",paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:3,hasRadius:!0,borderColor:"neutral200",children:e.jsx(R,{textColor:"neutral800",children:E.name})})},E.name)))}),e.jsx(Fe,{onClick:p=>p.stopPropagation(),startIcon:e.jsx(Me,{}),tag:se,to:`../components/${t.component}/configurations/edit`,children:m({id:u("components.FieldItem.linkToComponentLayout"),defaultMessage:"Set the component's layout"})})]}):null,t?.type==="dynamiczone"?e.jsx(I,{paddingTop:3,paddingRight:3,paddingBottom:3,paddingLeft:0,alignItems:"flex-start",gap:2,width:"100%",wrap:"wrap",children:t?.components.map(p=>e.jsxs(Ge,{onClick:k=>k.stopPropagation(),to:`../components/${p}/configurations/edit`,children:[e.jsx(Se,{icon:a[p].settings.icon}),e.jsx(R,{fontSize:1,textColor:"neutral600",fontWeight:"bold",children:a[p].settings.displayName})]},p))}):null]})]}),g.name!==D&&e.jsx(Pe,{attribute:t,name:s,onClose:()=>v(!1)})]}):null:null},Ve=oe(J)`
  height: unset;
  align-self: stretch;
  display: flex;
  align-items: center;
  padding: 0;
  border: none;
  background-color: transparent;
  border-radius: 0px;
  border-right: 1px solid ${({theme:t})=>t.colors.neutral150};
  cursor: all-scroll;

  svg {
    width: 1.2rem;
    height: 1.2rem;
  }
`,Ge=oe(se)`
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: ${({theme:t})=>t.spaces[1]};
  padding: ${t=>t.theme.spaces[2]};
  border: 1px solid ${({theme:t})=>t.colors.neutral200};
  background: ${({theme:t})=>t.colors.neutral0};
  width: 14rem;
  border-radius: ${({theme:t})=>t.borderRadius};
  text-decoration: none;

  &:focus,
  &:hover {
    ${({theme:t})=>`
      background-color: ${t.colors.primary100};
      border-color: ${t.colors.primary200};

      ${R} {
          color: ${t.colors.primary600};
      }
    `}

    /* > ComponentIcon */
    > div:first-child {
      background: ${({theme:t})=>t.colors.primary200};
      color: ${({theme:t})=>t.colors.primary600};

      svg {
        path {
          fill: ${({theme:t})=>t.colors.primary600};
        }
      }
    }
  }
`,at=({attributes:t,fieldSizes:a,layout:s,onSubmit:o})=>{const{components:d,settings:l,layout:f,metadatas:v}=s,{formatMessage:m}=A(),g=P.useMemo(()=>({layout:_e(Ke,Ue,qe,Ye,Je)(f),settings:l}),[f,l]);return e.jsx(e.Fragment,{children:e.jsx(Te,{children:e.jsxs(ne,{initialValues:g,onSubmit:o,method:"PUT",children:[e.jsx(Qe,{name:l.displayName??""}),e.jsx(re.Content,{children:e.jsxs(I,{alignItems:"stretch",background:"neutral0",direction:"column",gap:6,hasRadius:!0,shadow:"tableShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:[e.jsx(R,{variant:"delta",tag:"h2",children:m({id:u("containers.SettingPage.settings"),defaultMessage:"Settings"})}),e.jsxs(F.Root,{children:[e.jsx(F.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(ie,{type:"enumeration",label:m({id:u("containers.SettingPage.editSettings.entry.title"),defaultMessage:"Entry title"}),hint:m({id:u("containers.SettingPage.editSettings.entry.title.description"),defaultMessage:"Set the display field of your entry"}),name:"settings.mainField",options:Object.entries(t).reduce((b,[S,T])=>(T&&(te.includes(T.type)||b.push({label:S,value:S})),b),[])})}),e.jsx(F.Item,{paddingTop:6,paddingBottom:6,col:12,s:12,direction:"column",alignItems:"stretch",children:e.jsx(ke,{})}),e.jsx(F.Item,{col:12,s:12,direction:"column",alignItems:"stretch",children:e.jsx(R,{variant:"delta",tag:"h3",children:m({id:u("containers.SettingPage.view"),defaultMessage:"View"})})}),e.jsx(F.Item,{col:12,s:12,direction:"column",alignItems:"stretch",children:e.jsx(He,{attributes:t,components:d,fieldSizes:a,metadatas:v})})]})]})})]})})})},Ke=t=>t.flat(1),Ue=t=>t.map(a=>a.map(s=>({...s,mainField:s.mainField?.name}))),qe=t=>t.map(a=>a.map(({label:s,disabled:o,hint:d,placeholder:l,size:f,name:v,mainField:m})=>({label:s,editable:!o,description:d,mainField:m,placeholder:l,size:f,name:v,__temp_key__:""}))),Ye=t=>[...t.map(a=>{const s=a.reduce((o,d)=>o+d.size,0);return s<12?[...a,{name:D,size:12-s,__temp_key__:""}]:a})],Je=t=>{const a=Q(void 0,void 0,t.length);return t.map((s,o)=>{const d=Q(void 0,void 0,s.length);return{__temp_key__:a[o],children:s.map((l,f)=>({...l,__temp_key__:d[f]}))}})},Qe=({name:t})=>{const{formatMessage:a}=A(),s=z("Header",d=>d.modified),o=z("Header",d=>d.isSubmitting);return e.jsx(re.Header,{title:a({id:u("components.SettingsViewWrapper.pluginHeader.title"),defaultMessage:"Configure the view - {name}"},{name:ae(t)}),subtitle:a({id:u("components.SettingsViewWrapper.pluginHeader.description.edit-settings"),defaultMessage:"Customize how the edit view will look like."}),navigationAction:e.jsx(De,{}),primaryAction:e.jsx(Y,{disabled:!s,loading:o,type:"submit",children:a({id:"global.save",defaultMessage:"Save"})})})};export{at as C,D as T};
